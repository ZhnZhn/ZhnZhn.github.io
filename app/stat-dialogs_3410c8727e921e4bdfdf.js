"use strict";(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[301],{4965:(t,e,o)=>{o.r(e),o.d(e,{default:()=>bt});var s=o(1315),n=o(4558),i=o(9288),r=o(7104),a=o(7071),c=o(3375),l=o(6318);const d="_is",p=t=>`is${t}`;var u=o(4848);const h={wordBreak:"break-word"},m=(t,e,o)=>{let{isShowLabels:s,isRow:n,fSelect:i}=o;const{id:r,caption:a,options:c,placeholder:d}=t,m=!n[p(r)];return(0,u.jsx)(l.A.ShowHide,{isShow:m,children:(0,u.jsx)(l.A.RowInputSelect,{isShowLabels:s,caption:a,captionStyle:h,placeholder:d,options:c,onSelect:i(e)})},r)};var f=o(4575),g=o(4250),v=o(5286),y=o(3941),w=o(4302),S=o(2783);const O=()=>{const t=(0,s.li)([]),e=(0,s.hb)((e=>o=>{t.current[e]=o?{...o}:void 0}),[]);return[t,e]};var C=o(9495),b=o(7474),A=o(4066),I=o(4867);const T=t=>{const[e,o]=(0,I.Hn)({[d]:!0}),[n,i]=(0,s.Kr)((()=>[t=>o(p(t)),()=>o(d)]),[o]);return(0,s.vJ)((()=>{o(t.reduce(((t,e)=>(e.dfItem&&(t[p(e.id)]=!0),t)),{}))}),[t,o]),[e,n,i]},x=t=>{const[e,o]=(0,b.A)(),[n,i,r]=(0,C.R)(),[a,c,p]=T(t),h=a[d],[m,f,g]=(0,A.A)();return[(0,s.Kr)((()=>(0,u.jsx)(l.A.ModalToggle,{isShow:n,selectProps:t,isShowLabels:e,isShowChart:h,isCh:t.length>2,onToggleLabels:o,onToggle:c,onToggleChart:p,onCheckCaption:f,onUnCheckCaption:g,onClose:r})),[n,t,e,h]),m,e,a,i]};var F=o(8248),L=o(4428);const M=class{constructor(t){void 0===t&&(t=5e3),this.mls=t,this.isLoading=!1}start(t){return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((()=>{t===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}};var j=o(2823),D=o(3730);const q="time",$="Geo Entity";var E=o(9009);const k=(t,e,o)=>({caption:t,slice:{[e]:o}}),P=t=>(t||"").split("_").map(E.O).join(" "),R=(t,e)=>{const{label:o}=t||{};return(0,D.Co)(o).map((t=>({caption:o[t],value:t,id:e})))},_=t=>{for(let e=0;e<t.length;e++){const o=t[e]||{};if("freq"===o.v)return((o.options||[])[0]||{}).value}},J=t=>{const e=[null],o=[];(0,D.Co)(t).forEach((s=>{if(s!==q){const n=t[s],{label:i,category:r}=n||{},a={c:P(i),v:s,options:R(r,s)};"s_adj"===s?(a.c="Seasonal Adjustment",a.options=(t=>t.options.map((t=>(t.sc=t.value,t.caption=`${t.caption} (${t.value})`,t))))(a),o.push(a)):"geo"===s?(a.c=$,e[0]=a):e.push(a)}}));const s=(0,j.Bo)(e).concat(o);return{dims:s,mapFrequency:_(s),timeId:q}},N=t=>{let{values:e,id:o}=t;return(e||[]).map((t=>k(t.text,o,t.id)))},U=t=>{const e=[];let o;return t.forEach((t=>{const{time:s,text:n="",id:i}=t;s?(o=i,e.dateOptions=t.values.map((t=>{let{id:e,text:o}=t;return{caption:o,value:e}})).reverse()):e.push({c:(0,E.O)(n),v:i,options:N(t)})})),{mapFrequency:"Y",dims:e,timeId:o}},B=Array.isArray,H={month:"M",quarter:"K"},Q=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes","Jahr"],Y=(t,e)=>!B(t)||!B(e)||t.length!==e.length,Z=t=>{let{values:e,valueTexts:o,code:s}=t;if(!Y(e,o))return o.map(((t,o)=>k(t,s,e[o])))},K=t=>{const e=[];let o,s="Y";return t.forEach((t=>{const{code:n,time:i}=t,r=t.text||"";((t,e)=>!t&&-1===Q.indexOf(e)&&-1===(e+"").indexOf("TLIST("))(i,n)?e.push({c:(0,E.O)(r),v:n,options:Z(t)}):(o=n,s=H[r.toLowerCase()],e.dateOptions=(t=>{let{values:e,valueTexts:o}=t;if(Y(e,o))return;const s=[];return o.forEach(((t,o)=>{s.push({caption:t,value:e[o]})})),s.reverse()})(t))})),{mapFrequency:s,dims:e,timeId:o}},V=(t,e)=>fetch(t,e).then((t=>{const{status:e,statusText:o}=t;if(e>=200&&e<400)return t.json();if(403===e)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error(`HTTP Code: ${e} ${o}`)})),z=Array.isArray,G=t=>{const e=[],{variables:o,dimension:s,source:n}=t;return((t,e)=>t&&"ESTAT"===e)(s,n)?J(s):z(o)?(i=o[0])&&i.id&&i.text&&!z(i.valueTexts)&&z(i.values)?U(o):K(o):{dims:e,timeId:undefined,mapFrequency:"Y"};var i},W=t=>V(t).then(G);var X=o(8876);const tt=t=>"M"===t?"2019-01":"S"===t?"2019-S1":"Q"===t?"2019-Q1":"2019",et=(t,e)=>{let{dfNonTime:o,mapFrequency:s,dfId:n}=t;const i=(0,j.Bo)([e,o?"":`time=${tt(s)}`]).join("&"),r=i?"?"+i:"";return`${X.sS}/${n}${r}`},ot={DF:t=>{let{proxy:e="",baseMeta:o,dfId:s}=t;return`${e}${o}/${s}`},EU_STAT:et,FSO:t=>{let{proxy:e="",baseMeta:o,dfId:s}=t;return`${e}${o}/${s}/${s}.px`}},st=t=>t.dimUrl||(t=>(ot[t.loadId]||ot.DF)(t))(t),nt=(t,e,o)=>({id:t,caption:e,options:o}),it=(t,e)=>{const o=e?((t,e)=>{const o=Object.create(null);return t.forEach((t=>{o[t.v]=t})),e.map((t=>{let{v:e,c:s}=t;return nt(e,s,o[e].options)}))})(t,e):(t=>t.map((t=>{let{c:e,v:o,options:s}=t;return nt(o,e,s)})))(t);return o.dateOptions=t.dateOptions,(t=>{t.forEach(((t,e)=>{const{options:o}=t;if(1===o.length){const e=o[0];t.placeholder=e.caption,t.dfItem=e,t.isRow=!1}}))})(o),o},rt=(t,e)=>{const o=st(e),s=e.dims;return t.start(o),W(o).then((t=>{let{dims:e,mapFrequency:o,timeId:n}=t;if(!(t=>{const e=t.length;let o=0;for(;o<e&&t[o].options;o++);return o===e})(e))throw{errMsg:"Loaded dims without options"};return{timeId:n,mapFrequency:o,configs:it(e,s)}}))},at=t=>(t.options||[]).length,ct=(t,e)=>{const{dfQ:o}=e,s=et(e,o[0]),n=et(e,o[1]);let i=[];return t.start(s),W(s).then((t=>{let{dims:e}=t;i=i.concat(e)})).then((()=>{return t=5e3,new Promise((e=>{setTimeout((()=>e()),t)}));var t})).then((()=>(t.stop(),t.start(n),W(n)))).then((t=>{let{dims:e,mapFrequency:o,timeId:s}=t;return i=(t=>{const e=Object.create(null);return t.forEach((t=>{const o=t.v,s=e[o];(!s||at(s)<at(t))&&(e[o]=t)})),Object.keys(e).map((t=>e[t]))})(i.concat(e)),{timeId:"time",mapFrequency:o,configs:it(i)}}))},lt=Array.isArray,dt=new M,pt=t=>{let{errMsg:e,message:o}=t;return{errMsg:e||o}},ut=t=>{if(dt.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const e=(t=>{const{dfQ:e}=t;return lt(e)?2===e.length?ct:void 0:rt})(t);return e?e(dt,t).catch(pt).finally((()=>dt.stop())):Promise.resolve({errMsg:"Incorrect dialog configuration"})}},ht=(t,e)=>({caption:t,value:e}),mt=(t,e)=>{let{dims:o,proxy:s,baseMeta:n,loadId:i,mapFrequency:r,dfProps:a}=t;ut({dims:o,proxy:s,baseMeta:n,loadId:i,mapFrequency:r,...a}).then(e).catch((t=>{e({errMsg:t.message})}))},ft=()=>({isLoading:!0,isLoadFailed:!1}),gt=t=>t.map((t=>t.options)),vt=t=>{const e=[];return t.forEach((t=>{(t.options||[]).length>1&&e.push(ht(t.caption,t.id))})),e},yt=(t,e)=>{const{chartsType:o,mapFrequency:n,mapDateDf:r,loadId:a,dfProps:c={}}=t,l=c.mapFrequency||n||"M",d=c.mapDateDf||r,[{isLoading:p,isLoadFailed:u},h]=(0,s.J0)(ft),[m,f]=(0,s.J0)({configs:[],selectOptions:[],mapFrequency:n,chartOptions:[],dateOptions:[]}),g=(0,s.hb)((t=>{let{configs:s,timeId:n,mapFrequency:r,errMsg:c}=t;if(s){const t=r||l,[e,c]=((t,e,o,s)=>{const{dateOptions:n}=t;if(n)return[n,n[0]];const[i,r]=(0,L.A)(e,o,s);return[i,ht(r,r)]})(s,t,d,a);h({isLoading:!1,isLoadFailed:!1}),f({timeId:n,configs:s,selectOptions:gt(s),mapFrequency:t,dimOptions:vt(s),chartOptions:(0,i.O)(s,o,t),dateOptions:e,dateDf:c})}else h({isLoading:!1,isLoadFailed:!0}),e([c])}),[o,l,d,a,e]),v=((t,e)=>{const o=(0,F.A)(t.isShow);return e&&o})(t,u);return(0,s.vJ)((()=>{mt(t,g)}),[]),(0,s.vJ)((()=>{v&&(mt(t,g),h(ft))}),[v,t,g]),[m,p,u]},wt={...(0,n.g2)(80,"45%"),width:32,height:32,zIndex:8},St=t=>({width:t?350:267,height:72}),Ot=(t,e)=>t.dfC||(e||{}).value,Ct=(t,e)=>t.dfC||!e?"":e.caption||"",bt={StatN:(0,f.A)((t=>{const{isShow:e,caption:o,dfProps:n,msgOnNotSelected:p,toTopLayer:h,onAbout:f,loadFn:C,onLoad:b,onShow:A,onClose:I}=t,{dfRt:T}=n||{},F=!t.dims&&!t.notDim,[L,M]=(0,s.J0)(),[j,D]=O(),q=(0,s.li)(),[E,k]=(0,g.NC)(),[P,R]=(0,g.NC)(),[_,J]=(0,g.NC)(T),[N,U,B]=(0,v.A)(I),[H,Q,Y]=yt(t,U),{configs:Z,selectOptions:K,chartOptions:V,dimOptions:z,dateOptions:G,dateDf:W={},timeId:X}=H,[tt,et,ot,st,nt]=x(Z),it=st[d],[rt,at]=(0,y.A)(f),[ct,lt,dt,pt,ut]=(0,S.A)(),ht=(0,w.t)({toggleInputs:nt,toggleOptions:dt,onAbout:f}),mt=(0,s.hb)((()=>{const e=[];if(Y)return e.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),e;if(Q)return e.push("Dims is loading"),e;const o=(0,i.y)(L),{dim:n}=L||{},r=((t,e,o,s)=>n=>{o.forEach(((o,i)=>{const{caption:r}=o;n(r)&&!s[i]&&t.push(e(r))}))})(e,p,Z,(0,s.ZC)(j));if(!F||!o){const s=t.notDim?$:n;return r((t=>!(o&&t===s))),e}if(o){const t=R();if(!t)return e.push("Dim isn't selected"),e;r((e=>e!==t.caption))}return e}),[Y,Q,Z,L,p]),ft=(0,s.hb)((()=>{((t,e)=>{t.forEach(((t,o)=>{const{dfItem:s}=t;s&&e(o)(s)}))})(Z,D);const e=mt();if(0===e.length){const e=R();b(C({...t},{...(0,s.y5)(q),chartType:L,timeId:X,selectOptions:K,isCategory:(0,i.y)(L),dfC:Ot(t,e),dfTitle:Ct(t,e),time:(k()||W).value,dialogOptions:(0,s.ZC)(ct),items:(0,s.ZC)(j),titles:(0,s.ZC)(et),_rt:J()}))}U(e)}),[mt,W,X,L,Z,K]),gt=(0,c.JF)(Q,Y),vt=it&&(0,i.y)(L);return(0,u.jsxs)(l.A.DraggableDialog,{isFocusBtMenu:!1,isShow:e,caption:o,menuModel:at,toTopLayer:h,onLoad:ft,onShow:A,onClose:B,children:[(0,u.jsx)(l.A.Toolbar,{isShow:rt,buttons:ht}),(0,u.jsx)(l.A.ModalOptions,{isShow:lt,dfRt:T,onRoundTo:_,toggleOption:ut,onClose:pt}),tt,(0,u.jsx)(c.y$,{style:wt,status:gt}),gt?(0,u.jsx)("div",{style:St(ot)}):(0,u.jsxs)(r.A,{is:e,children:[(0,u.jsx)(a.A,{items:Z,crItem:m,isShowLabels:ot,isRow:st,fSelect:D}),(0,u.jsx)(l.A.RowChartDate,{refSeriaColor:q,chartType:L,isShowLabels:ot,isShowChart:it,isShowDate:vt,chartOptions:V,onSelectChart:M,dateDefault:W.caption,dateOptions:G,onSelectDate:E,isDim:F,dimOptions:z,onSelectDim:P})]}),(0,u.jsx)(l.A.ValidationMessages,{validationMessages:N})]})}))}}}]);