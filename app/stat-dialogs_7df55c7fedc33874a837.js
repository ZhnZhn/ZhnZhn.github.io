"use strict";(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[418],{2796:(t,e,o)=>{o.r(e),o.d(e,{default:()=>It});var s=o(8504),n=o(904),i=o(5916),r=o(6584),a=o(6509);var c=o(7624);const l={position:"absolute",top:80,left:"45%",zIndex:10,display:"block",width:32,height:32,opacity:1,transition:"opacity 800ms ease-out"},d={borderColor:"#f44336",animation:"none"},p={opacity:0},u=t=>{let{style:e,status:o}=t;const n=(t=>{const[e,o]=(0,s.oT)(!1);return(0,s.YB)((()=>{t||setTimeout((()=>o(!0)),1e3)}),[t]),e})(o),i="L"===o?l:"F"===o?d:p;return n?null:(0,c.jsx)("span",{style:{...l,...e,...i},"data-loader":"circle"})},h=t=>`is${t}Select`,m={wordBreak:"break-word"},f=(t,e,o)=>{let{isShowLabels:s,isRow:n,fSelect:i}=o;const{id:r,caption:l,options:d,placeholder:p}=t,u=!n[h(r)];return(0,c.jsx)(a.c.ShowHide,{isShow:u,children:(0,c.jsx)(a.c.RowInputSelect,{isShowLabels:s,caption:l,captionStyle:m,placeholder:p,options:d,onSelect:i(e)})},r)};var g=o(4332),y=o(312),v=o(2660),w=o(468),S=o(6532),T=o(5784),b=o(6379);const I=()=>{const t=(0,s.yK)([]),e=(0,s.kZ)((e=>o=>{t.current[e]=o?{...o}:void 0}),[]);return[t,e]};var O=o(5588),C=o(2880),L=o(7480);const x=t=>{const[e,o]=(0,L.c)({isShowChart:!0});return(0,s.YB)((()=>{const e=t.reduce(((t,e)=>(e.dfItem&&(t[h(e.id)]=!0),t)),{});o(e)}),[t,o]),[e,o]},F=t=>{const[e,o,n]=(0,O.a)(),[i,r]=x(t),{isShowChart:l}=i,[d,p,u]=(0,C.c)();return[(0,s.bB)((()=>(0,c.jsx)(a.c.ModalToggle,{isShow:e,selectProps:t,isShowChart:l,crIsId:h,onToggle:r,onCheckCaption:p,onUnCheckCaption:u,onClose:n})),[e,t,l]),d,i,o]};var j=o(1472);const D=class{constructor(t){void 0===t&&(t=5e3),this.mls=t,this.isLoading=!1}start(t){return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((()=>{t===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}},q="time",M="Geo Entity",k=(t,e,o)=>({caption:t,slice:{[e]:o}}),E=t=>t?t.charAt(0).toUpperCase()+t.substring(1):"",A=Object.keys,B=t=>(t||"").split("_").map(E).join(" "),$=(t,e)=>{const{label:o}=t||{};return A(o||{}).map((t=>({caption:o[t],value:t,id:e})))},_=t=>{const e=[null],o=[];return A(t).forEach((s=>{if(s!==q){const n=t[s],{label:i,category:r}=n||{},a={c:B(i),v:s,options:$(r,s)};"s_adj"===s?(a.c="Seasonal Adjustment",a.options=(t=>t.options.map((t=>(t.sc=t.value,t.caption=`${t.caption} (${t.value})`,t))))(a),o.push(a)):"geo"===s?(a.c=M,e[0]=a):e.push(a)}})),{dims:e.filter(Boolean).concat(o),timeId:q}},P=t=>{let{values:e,id:o}=t;return(e||[]).map((t=>k(t.text,o,t.id)))},Y=t=>{const e=[];let o;return t.forEach((t=>{const{time:s,text:n="",id:i}=t;s?(o=i,e.dateOptions=t.values.map((t=>{let{id:e,text:o}=t;return{caption:o,value:e}})).reverse()):e.push({c:E(n),v:i,options:P(t)})})),{mapFrequency:"Y",dims:e,timeId:o}},R=Array.isArray,U={month:"M",quarter:"K"},K=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes"],Q=(t,e)=>!R(t)||!R(e)||t.length!==e.length,Z=t=>{let{values:e,valueTexts:o,code:s}=t;if(!Q(e,o))return o.map(((t,o)=>k(t,s,e[o])))},H=t=>{const e=[];let o,s="Y";return t.forEach((t=>{const{code:n,time:i}=t,r=t.text||"";((t,e)=>!t&&-1===K.indexOf(e)&&-1===(e+"").indexOf("TLIST("))(i,n)?e.push({c:E(r),v:n,options:Z(t)}):(o=n,s=U[r.toLowerCase()],e.dateOptions=(t=>{let{values:e,valueTexts:o}=t;if(Q(e,o))return;const s=[];return o.forEach(((t,o)=>{s.push({caption:t,value:e[o]})})),s.reverse()})(t))})),{mapFrequency:s,dims:e,timeId:o}},N=(t,e)=>fetch(t,e).then((t=>{const{status:e,statusText:o}=t;if(e>=200&&e<400)return t.json();if(403===e)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error(`HTTP Code: ${e} ${o}`)})),V=Array.isArray,z=t=>{const e=[],{variables:o,dimension:s,source:n}=t;return((t,e)=>t&&"ESTAT"===e)(s,n)?_(s):V(o)?(i=o[0])&&i.id&&i.text&&!V(i.valueTexts)&&V(i.values)?Y(o):H(o):{dims:e,timeId:undefined,mapFrequency:"Y"};var i},G=t=>N(t).then(z);var J=o(5180);const W=t=>"M"===t?"2019-01":"S"===t?"2019-S1":"Q"===t?"2019-Q1":"2019",X=(t,e)=>{let{dfNonTime:o,mapFrequency:s,dfId:n}=t;const i=[e,o?"":`time=${W(s)}`].filter(Boolean).join("&"),r=i?"?"+i:"";return`${J.UD}/${n}${r}`},tt={DF:t=>{let{proxy:e="",baseMeta:o,dfId:s}=t;return`${e}${o}/${s}`},EU_STAT:X},et=t=>t.dimUrl||(t=>(tt[t.loadId]||tt.DF)(t))(t),ot=(t,e,o)=>({id:t,caption:e,options:o}),st=(t,e)=>{const o=e?((t,e)=>{const o=Object.create(null);return t.forEach((t=>{o[t.v]=t})),e.map((t=>{let{v:e,c:s}=t;return ot(e,s,o[e].options)}))})(t,e):(t=>t.map((t=>{let{c:e,v:o,options:s}=t;return ot(o,e,s)})))(t);return o.dateOptions=t.dateOptions,(t=>{t.forEach(((t,e)=>{const{options:o}=t;if(1===o.length){const e=o[0];t.placeholder=e.caption,t.dfItem=e,t.isRow=!1}}))})(o),o},nt=(t,e)=>{const o=et(e),s=e.dims;return t.start(o),G(o).then((t=>{let{dims:e,mapFrequency:o,timeId:n}=t;if(!(t=>{const e=t.length;let o=0;for(;o<e&&t[o].options;o++);return o===e})(e))throw{errMsg:"Loaded dims without options"};return{timeId:n,mapFrequency:o,configs:st(e,s)}}))},it=t=>(t.options||[]).length,rt=(t,e)=>{const{dfQ:o}=e,s=X(e,o[0]),n=X(e,o[1]);let i=[];return t.start(s),G(s).then((t=>{let{dims:e}=t;i=i.concat(e)})).then((()=>{return t=5e3,new Promise((e=>{setTimeout((()=>e()),t)}));var t})).then((()=>(t.stop(),t.start(n),G(n)))).then((t=>{let{dims:e,mapFrequency:o,timeId:s}=t;return i=(t=>{const e=Object.create(null);return t.forEach((t=>{const o=t.v,s=e[o];(!s||it(s)<it(t))&&(e[o]=t)})),Object.keys(e).map((t=>e[t]))})(i.concat(e)),{timeId:"time",mapFrequency:o,configs:st(i)}}))},at=Array.isArray,ct=new D,lt=t=>{let{errMsg:e,message:o}=t;return{errMsg:e||o}},dt=t=>{if(ct.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const e=(t=>{const{dfQ:e}=t;return at(e)?2===e.length?rt:void 0:nt})(t);return e?e(ct,t).catch(lt).finally((()=>ct.stop())):Promise.resolve({errMsg:"Incorrect dialog configuration"})}},pt=t=>{const e=(0,s.yK)();return(0,s.YB)((()=>{e.current=t}),[t]),e.current},ut=(t,e)=>({caption:t,value:e}),ht=(t,e)=>{let{dims:o,proxy:s,baseMeta:n,loadId:i,mapFrequency:r,dfProps:a}=t;dt({dims:o,proxy:s,baseMeta:n,loadId:i,mapFrequency:r,...a}).then(e).catch((t=>{e({errMsg:t.message})}))},mt=()=>({isLoading:!0,isLoadFailed:!1}),ft=t=>t.map((t=>t.options)),gt=t=>{const e=[];return t.forEach((t=>{(t.options||[]).length>1&&e.push(ut(t.caption,t.id))})),e},yt=(t,e)=>{const{chartsType:o,mapFrequency:n,mapDateDf:r,loadId:a,dfProps:c={}}=t,l=c.mapFrequency||n||"M",d=c.mapDateDf||r,[{isLoading:p,isLoadFailed:u},h]=(0,s.oT)(mt),[m,f]=(0,s.oT)((()=>({configs:[],selectOptions:[],mapFrequency:n,chartOptions:(0,i.Cg)(t),dateOptions:[]}))),g=(0,s.kZ)((t=>{let{configs:s,timeId:n,mapFrequency:r,errMsg:c}=t;if(s){const t=r||l,[e,c]=((t,e,o,s)=>{const{dateOptions:n}=t;if(n)return[n,n[0]];const[i,r]=(0,j.c)(e,o,s);return[i,ut(r,r)]})(s,t,d,a);h({isLoading:!1,isLoadFailed:!1}),f({timeId:n,configs:s,selectOptions:ft(s),mapFrequency:t,dimOptions:gt(s),chartOptions:(0,i.Cg)({configs:s,chartsType:o,mapFrequency:t}),dateOptions:e,dateDf:c})}else h({isLoading:!1,isLoadFailed:!0}),e([c])}),[o,l,d,a,e]),y=((t,e)=>{const o=pt(t);return e&&!o.isShow&&t.isShow})(t,u);return(0,s.YB)((()=>{ht(t,g)}),[]),(0,s.YB)((()=>{y&&(ht(t,g),h(mt))}),[y,t,g]),[m,p,u]},vt=(t,e)=>t?"L":e?"F":void 0,wt={height:50,width:"100%"},St=(0,n.k1)(),Tt=(t,e)=>t.dfC||(e||{}).value,bt=(t,e)=>t.dfC||!e?"":e.caption||"",It={StatN:(0,g.c)((t=>{const{isShow:e,caption:o,dfProps:n,msgOnNotSelected:l,toTopLayer:d,onAbout:p,loadFn:h,onLoad:m,onShow:g,onClose:O}=t,{dfRt:C}=n||{},L=!t.dims&&!t.notDim,[x,j]=(0,s.oT)(),[D,q]=I(),k=(0,s.yK)(),[E,A]=(0,v.c)(),[B,$]=(0,v.c)(),[_,P]=(0,v.c)(C),[Y,R,U]=(0,w.c)(O),[K,Q,Z]=yt(t,R),{configs:H,selectOptions:N,chartOptions:V,dimOptions:z,dateOptions:G,dateDf:J={},timeId:W}=K,[X,tt]=(0,y.c)(St),[et,ot,st,nt]=F(H),{isShowChart:it}=st,[rt,at]=(0,S.c)(p),[ct,lt,dt,pt,ut]=(0,b.c)(),ht=(0,T.c)({toggleLabels:tt,toggleInputs:nt,toggleOptions:dt,onAbout:p}),mt=(0,s.kZ)((()=>{const e=[];if(Z)return e.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),e;if(Q)return e.push("Dims is loading"),e;const o=(0,i.y_)(x),{dim:n}=x||{},r=((t,e,o,s)=>n=>{o.forEach(((o,i)=>{const{caption:r}=o;n(r)&&!s[i]&&t.push(e(r))}))})(e,l,H,(0,s.sB)(D));if(!L||!o){const s=t.notDim?M:n;return r((t=>!(o&&t===s))),e}if(o){const t=$();if(!t)return e.push("Dim isn't selected"),e;r((e=>e!==t.caption))}return e}),[Z,Q,H,x,l]),ft=(0,s.kZ)((()=>{((t,e)=>{t.forEach(((t,o)=>{const{dfItem:s}=t;s&&e(o)(s)}))})(H,q);const e=mt();if(0===e.length){const e=$();m(h({...t},{...(0,s.aq)(k),chartType:x,timeId:W,selectOptions:N,isCategory:(0,i.y_)(x),dfC:Tt(t,e),dfTitle:bt(t,e),time:(A()||J).value,dialogOptions:(0,s.sB)(ct),items:(0,s.sB)(D),titles:(0,s.sB)(ot),_rt:P()}))}R(e)}),[mt,J,W,x,H,N]),gt=vt(Q,Z),It=(0,i.y_)(x);return(0,c.jsxs)(a.c.DraggableDialog,{isShow:e,caption:o,menuModel:at,toTopLayer:d,onLoad:ft,onShow:g,onClose:U,children:[(0,c.jsx)(a.c.Toolbar,{isShow:rt,buttons:ht}),(0,c.jsx)(a.c.ModalOptions,{isShow:lt,dfRt:C,onRoundTo:_,toggleOption:ut,onClose:pt}),et,(0,c.jsx)(u,{status:gt}),gt?(0,c.jsx)("div",{style:wt}):(0,c.jsx)(r.c,{items:H,crItem:f,isShowLabels:X,isRow:st,fSelect:q}),(0,c.jsx)(a.c.RowChartDate,{refSeriaColor:k,chartType:x,isShowLabels:X,isShowChart:it,chartOptions:V,onSelectChart:j,isShowDate:It,dateDefault:J.caption,dateOptions:G,onSelectDate:E,isDim:L,dimOptions:z,onSelectDim:B}),(0,c.jsx)(a.c.ValidationMessages,{validationMessages:Y})]})}))}}}]);