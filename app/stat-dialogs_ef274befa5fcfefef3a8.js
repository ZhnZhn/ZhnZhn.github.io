"use strict";(self.webpackChunkweb_app_erc=self.webpackChunkweb_app_erc||[]).push([[301],{4965:(t,e,o)=>{o.r(e),o.d(e,{default:()=>jt});var s=o(1315),n=o(4558),i=o(9288),r=o(2655),a=o(7104),c=o(3375),d=o(7071),l=o(9759),p=o(9878),u=o(5189),h=o(3349),m=o(2357),f=o(5317);const g="_is",v=t=>`is${t}`;var y=o(4848);const w={wordBreak:"break-word"},S=(t,e,o)=>(0,y.jsx)(m.A,{isShow:!o.isRow[v(t.id)],children:(0,y.jsx)(f.A,{captionStyle:w,caption:t.caption,placeholder:t.placeholder,options:t.options,isShowLabels:o.isShowLabels,onSelect:o.fSelect(e)})},t.id);var O=o(4575),C=o(4250),b=o(5286),A=o(3941),I=o(4302),x=o(2783);const T=()=>{const t=(0,s.li)([]),e=(0,s.hb)((e=>o=>{t.current[e]=o?{...o}:void 0}),[]);return[t,e]};var F=o(9495),L=o(7474),j=o(4066),q=o(4867);const M=t=>{const[e,o]=(0,q.Hn)({[g]:!0}),[n,i]=(0,s.Kr)((()=>[t=>o(v(t)),()=>o(g)]),[o]);return(0,s.vJ)((()=>{o(t.reduce(((t,e)=>(e.dfItem&&(t[v(e.id)]=!0),t)),{}))}),[t,o]),[e,n,i]};var D=o(4947);const $=t=>{const[e,o]=(0,L.A)(),[n,i,r]=(0,F.R)(),[a,c,d]=M(t),l=a[g],[p,u,h]=(0,j.A)();return[(0,s.Kr)((()=>(0,y.jsx)(D.A,{isShow:n,selectProps:t,isShowLabels:e,isShowChart:l,isCh:t.length>2,onToggleLabels:o,onToggle:c,onToggleChart:d,onCheckCaption:u,onUnCheckCaption:h,onClose:r})),[n,t,e,l]),p,e,a,i]};var E=o(8248),k=o(4428);const P=class{constructor(t){void 0===t&&(t=5e3),this.mls=t,this.isLoading=!1}start(t){return!this.isLoading&&(this.loadingUrl=t,this.isLoading=!0,this.timeoutId=setTimeout((()=>{t===this.loadingUrl&&(this.isLoading=!1)}),this.mls),!0)}stop(){this.isLoading=!1,clearTimeout(this.timeoutId)}};var _=o(2823),J=o(3730);const R="time",N="Geo Entity";var U=o(9009);const B=(t,e,o)=>({caption:t,slice:{[e]:o}}),Q=t=>(t||"").split("_").map(U.O).join(" "),Y=(t,e)=>{const{label:o}=t||{};return(0,J.Co)(o).map((t=>({caption:o[t],value:t,id:e})))},Z=t=>{for(let e=0;e<t.length;e++){const o=t[e]||{};if("freq"===o.v)return((o.options||[])[0]||{}).value}},H=t=>{const e=[null],o=[];(0,J.Co)(t).forEach((s=>{if(s!==R){const n=t[s],{label:i,category:r}=n||{},a={c:Q(i),v:s,options:Y(r,s)};"s_adj"===s?(a.c="Seasonal Adjustment",a.options=(t=>t.options.map((t=>(t.sc=t.value,t.caption=`${t.caption} (${t.value})`,t))))(a),o.push(a)):"geo"===s?(a.c=N,e[0]=a):e.push(a)}}));const s=(0,_.Bo)(e).concat(o);return{dims:s,mapFrequency:Z(s),timeId:R}},K=t=>{let{values:e,id:o}=t;return(e||[]).map((t=>B(t.text,o,t.id)))},V=t=>{const e=[];let o;return t.forEach((t=>{const{time:s,text:n="",id:i}=t;s?(o=i,e.dateOptions=t.values.map((t=>{let{id:e,text:o}=t;return{caption:o,value:e}})).reverse()):e.push({c:(0,U.O)(n),v:i,options:K(t)})})),{mapFrequency:"Y",dims:e,timeId:o}},z=Array.isArray,G={month:"M",quarter:"K"},W=["Tid","Year","Month","Vuosi","VuosineljÃ¤nnes","Jahr"],X=(t,e)=>!z(t)||!z(e)||t.length!==e.length,tt=t=>{let{values:e,valueTexts:o,code:s}=t;if(!X(e,o))return o.map(((t,o)=>B(t,s,e[o])))},et=t=>{const e=[];let o,s="Y";return t.forEach((t=>{const{code:n,time:i}=t,r=t.text||"";((t,e)=>!t&&-1===W.indexOf(e)&&-1===(e+"").indexOf("TLIST("))(i,n)?e.push({c:(0,U.O)(r),v:n,options:tt(t)}):(o=n,s=G[r.toLowerCase()],e.dateOptions=(t=>{let{values:e,valueTexts:o}=t;if(X(e,o))return;const s=[];return o.forEach(((t,o)=>{s.push({caption:t,value:e[o]})})),s.reverse()})(t))})),{mapFrequency:s,dims:e,timeId:o}},ot=(t,e)=>fetch(t,e).then((t=>{const{status:e,statusText:o}=t;if(e>=200&&e<400)return t.json();if(403===e)throw Error("HTTP Code 403: Forbitten.\nMaybe, require API key.");throw Error(`HTTP Code: ${e} ${o}`)})),st=Array.isArray,nt=t=>{const e=[],{variables:o,dimension:s,source:n}=t;return((t,e)=>t&&"ESTAT"===e)(s,n)?H(s):st(o)?(i=o[0])&&i.id&&i.text&&!st(i.valueTexts)&&st(i.values)?V(o):et(o):{dims:e,timeId:undefined,mapFrequency:"Y"};var i},it=t=>ot(t).then(nt);var rt=o(8876);const at=t=>"M"===t?"2019-01":"S"===t?"2019-S1":"Q"===t?"2019-Q1":"2019",ct=(t,e)=>{let{dfNonTime:o,mapFrequency:s,dfId:n}=t;const i=(0,_.Bo)([e,o?"":`time=${at(s)}`]).join("&"),r=i?"?"+i:"";return`${rt.sS}/${n}${r}`},dt={DF:t=>{let{proxy:e="",baseMeta:o,dfId:s}=t;return`${e}${o}/${s}`},EU_STAT:ct,FSO:t=>{let{proxy:e="",baseMeta:o,dfId:s}=t;return`${e}${o}/${s}/${s}.px`}},lt=t=>t.dimUrl||(t=>(dt[t.loadId]||dt.DF)(t))(t),pt=(t,e,o)=>({id:t,caption:e,options:o}),ut=(t,e)=>{const o=e?((t,e)=>{const o=Object.create(null);return t.forEach((t=>{o[t.v]=t})),e.map((t=>{let{v:e,c:s}=t;return pt(e,s,o[e].options)}))})(t,e):(t=>t.map((t=>{let{c:e,v:o,options:s}=t;return pt(o,e,s)})))(t);return o.dateOptions=t.dateOptions,(t=>{t.forEach(((t,e)=>{const{options:o}=t;if(1===o.length){const e=o[0];t.placeholder=e.caption,t.dfItem=e,t.isRow=!1}}))})(o),o},ht=(t,e)=>{const o=lt(e),s=e.dims;return t.start(o),it(o).then((t=>{let{dims:e,mapFrequency:o,timeId:n}=t;if(!(t=>{const e=t.length;let o=0;for(;o<e&&t[o].options;o++);return o===e})(e))throw{errMsg:"Loaded dims without options"};return{timeId:n,mapFrequency:o,configs:ut(e,s)}}))},mt=t=>(t.options||[]).length,ft=(t,e)=>{const{dfQ:o}=e,s=ct(e,o[0]),n=ct(e,o[1]);let i=[];return t.start(s),it(s).then((t=>{let{dims:e}=t;i=i.concat(e)})).then((()=>{return t=5e3,new Promise((e=>{setTimeout((()=>e()),t)}));var t})).then((()=>(t.stop(),t.start(n),it(n)))).then((t=>{let{dims:e,mapFrequency:o,timeId:s}=t;return i=(t=>{const e=Object.create(null);return t.forEach((t=>{const o=t.v,s=e[o];(!s||mt(s)<mt(t))&&(e[o]=t)})),Object.keys(e).map((t=>e[t]))})(i.concat(e)),{timeId:"time",mapFrequency:o,configs:ut(i)}}))},gt=Array.isArray,vt=new P,yt=t=>{let{errMsg:e,message:o}=t;return{errMsg:e||o}},wt=t=>{if(vt.isLoading)return Promise.resolve({errMsg:"Another dialog are still loading"});{const e=(t=>{const{dfQ:e}=t;return gt(e)?2===e.length?ft:void 0:ht})(t);return e?e(vt,t).catch(yt).finally((()=>vt.stop())):Promise.resolve({errMsg:"Incorrect dialog configuration"})}},St=(t,e)=>({caption:t,value:e}),Ot=(t,e)=>{let{dims:o,proxy:s,baseMeta:n,loadId:i,mapFrequency:r,dfProps:a}=t;wt({dims:o,proxy:s,baseMeta:n,loadId:i,mapFrequency:r,...a}).then(e).catch((t=>{e({errMsg:t.message})}))},Ct=()=>({isLoading:!0,isLoadFailed:!1}),bt=t=>t.map((t=>t.options)),At=t=>{const e=[];return t.forEach((t=>{(t.options||[]).length>1&&e.push(St(t.caption,t.id))})),e},It=(t,e)=>{const{chartsType:o,mapFrequency:n,mapDateDf:r,loadId:a,dfProps:c={}}=t,d=c.mapFrequency||n||"M",l=c.mapDateDf||r,[{isLoading:p,isLoadFailed:u},h]=(0,s.J0)(Ct),[m,f]=(0,s.J0)({configs:[],selectOptions:[],mapFrequency:n,chartOptions:[],dateOptions:[]}),g=(0,s.hb)((t=>{let{configs:s,timeId:n,mapFrequency:r,errMsg:c}=t;if(s){const t=r||d,[e,c]=((t,e,o,s)=>{const{dateOptions:n}=t;if(n)return[n,n[0]];const[i,r]=(0,k.A)(e,o,s);return[i,St(r,r)]})(s,t,l,a);h({isLoading:!1,isLoadFailed:!1}),f({timeId:n,configs:s,selectOptions:bt(s),mapFrequency:t,dimOptions:At(s),chartOptions:(0,i.O)(s,o,t),dateOptions:e,dateDf:c})}else h({isLoading:!1,isLoadFailed:!0}),e([c])}),[o,d,l,a,e]),v=((t,e)=>{const o=(0,E.A)(t.isShow);return e&&o})(t,u);return(0,s.vJ)((()=>{Ot(t,g)}),[]),(0,s.vJ)((()=>{v&&(Ot(t,g),h(Ct))}),[v,t,g]),[m,p,u]},xt={...(0,n.g2)(80,"45%"),width:32,height:32,zIndex:8},Tt=t=>({width:t?350:267,height:72}),Ft=(t,e)=>t.dfC||(e||{}).value,Lt=(t,e)=>t.dfC||!e?"":e.caption||"",jt={StatN:(0,O.A)((t=>{const{isShow:e,caption:o,dfProps:n,msgOnNotSelected:m,toTopLayer:f,onAbout:v,loadFn:w,onLoad:O,onShow:F,onClose:L}=t,{dfRt:j}=n||{},q=!t.dims&&!t.notDim,[M,D]=(0,s.J0)(),[E,k]=T(),P=(0,s.li)(),[_,J]=(0,C.NC)(),[R,U]=(0,C.NC)(),[B,Q]=(0,C.NC)(j),[Y,Z,H]=(0,b.A)(L),[K,V,z]=It(t,Z),{configs:G,selectOptions:W,chartOptions:X,dimOptions:tt,dateOptions:et,dateDf:ot={},timeId:st}=K,[nt,it,rt,at,ct]=$(G),dt=at[g],[lt,pt]=(0,A.A)(v),[ut,ht,mt,ft,gt]=(0,x.A)(),vt=(0,I.t)({toggleInputs:ct,toggleOptions:mt,onAbout:v}),yt=(0,s.hb)((()=>{const e=[];if(z)return e.push("Dims for request haven't been loaded.\nClose, open dialog for trying load again."),e;if(V)return e.push("Dims is loading"),e;const o=(0,i.y)(M),{dim:n}=M||{},r=((t,e,o,s)=>n=>{o.forEach(((o,i)=>{const{caption:r}=o;n(r)&&!s[i]&&t.push(e(r))}))})(e,m,G,(0,s.ZC)(E));if(!q||!o){const s=t.notDim?N:n;return r((t=>!(o&&t===s))),e}if(o){const t=U();if(!t)return e.push("Dim isn't selected"),e;r((e=>e!==t.caption))}return e}),[z,V,G,M,m]),wt=(0,s.hb)((()=>{((t,e)=>{t.forEach(((t,o)=>{const{dfItem:s}=t;s&&e(o)(s)}))})(G,k);const e=yt();if(0===e.length){const e=U();O(w({...t},{...(0,s.y5)(P),chartType:M,timeId:st,selectOptions:W,isCategory:(0,i.y)(M),dfC:Ft(t,e),dfTitle:Lt(t,e),time:(J()||ot).value,dialogOptions:(0,s.ZC)(ut),items:(0,s.ZC)(E),titles:(0,s.ZC)(it),_rt:Q()}))}Z(e)}),[yt,ot,st,M,G,W]),St=(0,c.JF)(V,z),Ot=dt&&(0,i.y)(M);return(0,y.jsxs)(r.A,{isFocusBtMenu:!1,isShow:e,caption:o,menuModel:pt,toTopLayer:f,onLoad:wt,onShow:F,onClose:H,children:[(0,y.jsx)(p.A,{isShow:lt,buttons:vt}),(0,y.jsx)(u.A,{isShow:ht,dfRt:j,onRoundTo:B,toggleOption:gt,onClose:ft}),nt,(0,y.jsx)(c.y$,{style:xt,status:St}),St?(0,y.jsx)("div",{style:Tt(rt)}):(0,y.jsxs)(a.A,{is:e,children:[(0,y.jsx)(d.A,{items:G,crItem:S,isShowLabels:rt,isRow:at,fSelect:k}),(0,y.jsx)(h.A,{refSeriaColor:P,chartType:M,isShowLabels:rt,isShowChart:dt,isShowDate:Ot,chartOptions:X,onSelectChart:D,dateDefault:ot.caption,dateOptions:et,onSelectDate:_,isDim:q,dimOptions:tt,onSelectDim:R})]}),(0,y.jsx)(l.A,{validationMessages:Y})]})}))}}}]);